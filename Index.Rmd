---
title: "Final Project- Data Management"
author: "Sierrah Mueller"
date: "2023-11-30"
output: html_document
---

```{r setup libraries, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(readxl)
library(DHARMa)
library(MASS)
library(pscl)
library(AER)
library(tidyverse)
library(readxl)
```

# Chapter 2 RMD: Juvenile Redtail Parrotfish Habitat 

## Research Question 1
### Is there a difference in Redtail Parrotfish Density Between Habitat Types and Size Classes

```{r, echo = FALSE}

abundance_dfnewimport <- read_excel("Data/CombinedData_Abundance-Habitat.xlsx", sheet = "OverallHabitatANOVA")
abundance_df <- abundance_dfnewimport %>%
  mutate(totalabun = rowSums(.[2:9]))
density_df <- abundance_df %>%
  mutate(density = totalabun*2) %>%
  mutate(MajorHabitat = ifelse(MajorHabitat == "Seagrass", "Seagrass Fringe", MajorHabitat))
# density_df
density_df
kruskal.test(density ~ MajorHabitat, data = density_df)
pairwise <- pairwise.wilcox.test(density_df$density, density_df$MajorHabitat,
                     p.adjust.method = "BH")
pairwise

fig1 <- ggplot(density_df, aes(x = MajorHabitat, y = density)) +
  geom_boxplot(outlier.colour = "grey", outlier.shape = 16, outlier.size = 1) +
  geom_jitter(width = 0.3, size = 1, alpha = 0.2) +
  labs(y=bquote("Density (N per 100 m"^"2"*")")) +
  xlab("Habitat Type") +
  theme(axis.text.x=element_text(size=9))
fig1
```


## Research Question 2

### How does benthic substrate percent cover affect the density of Redtail Parrotfish? 
Negative Binomial Regression
```{r NBR: Substrate, echo= FALSE, message = FALSE}
glm_df <- read_excel("Data/glm_df.xlsx")

poisson_benthic <- glm(Abundance ~ MacaUNSP + Dictyota + TURF + SEAGRASS + CORAL + SPONGE, family = "poisson", data = glm_df)
summary(poisson_benthic)
dispersiontest(poisson_benthic)
m_benthic <- glm.nb(Abundance ~ MacaUNSP + Dictyota + TURF + SEAGRASS + CORAL + SPONGE , data = glm_df)
summary(m_benthic)
odTest(m_benthic)
```

### How do complexity and depth affect the density of Redtail Parrotfish?
```{r NBR, echo= FALSE, message = FALSE}
nbr_complexdepth <- read_excel("Data/nbr_complexdepth.xlsx")
noout <- subset(nbr_complexdepth,Complexity < 100)



```

